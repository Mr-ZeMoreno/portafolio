<script>
    import { Console } from "../js/commandConsole";
    import { $, $$, clases, dotClass } from "../js/utils";

    document.addEventListener("DOMContentLoaded", () => {
        const $inputElement = $("#input-msg") as HTMLInputElement;

        $(".consola-box")?.addEventListener("click", () => {
            $inputElement.focus();
        });

        $("#input-form")?.addEventListener("submit", function (event) {
            event.preventDefault();

            // Guardamos nuestro elemento $consola y instanciamos la clase consola
            const $consola = $(dotClass(clases.CONSOLA));
            const consola = new Console($consola);

            // Guardamos el elemento $inputElement y si existe seguimos con el código
            if ($inputElement) {
                const inputValue = $inputElement.value;
                consola.limpiarInput($inputElement);

                // Guardamos todos los elementos con clase INLINE (ver utils.ts) que esten en el elemento $consola
                let $$inlineMsg = $$(dotClass(clases.INLINE), $consola);
                let contador = $$inlineMsg.length + 1; // Aun no sé bien pero el contador comienza en cero por eso sumo 1

                const $msgElement = $(dotClass(clases.MSG));
                if ($msgElement) {
                    consola.appendChild(inputValue, clases.INLINE);
                }

                if (contador % 8 == 0 && contador > 0) {
                    const $alertMsg = $$(dotClass(clases.ALERTA), $consola);
                    consola.removeAllElements($alertMsg);
                    consola.appendChild(
                        "intenta usar el comando 'clear'",
                        clases.ALERTA,
                    );
                }

                consola.command($consola, inputValue);
            }
        });
    });
</script>

<div
    class="consola-box h-48 md:h-full max-h-48 md:max-h-none overflow-y-scroll bg-[#000000ac] md:bg-[#00000029]"
>
    <form id="input-form">
        <label>
            <span class="green">></span>
            <input
                id="input-msg"
                type="text"
                name="linea de comandos"
                autocomplete="off"
            />
        </label>
    </form>
    <div class="consola msg"></div>
</div>

<style is:global>
    .inline-msg,
    .alerta-msg {
        display: flex;
        flex-direction: row;
        p {
            padding-left: 5px;
        }
    }
    .alerta-msg > p {
        margin: 0 auto;
        text-align: center;
    }
    .green {
        color: #25cc54;
    }
    .alerta-msg > .green {
        display: none;
    }
</style>

<style>
    .consola-box,
    #input-form {
        font-family: "Orbitron";
    }

    #input-form {
        label {
            display: flex;
            flex-direction: row;
            input {
                background: transparent;
                border: 0;
                outline: none;
                padding-left: 5px;
                font-size: 12px;
                color: white;
            }
        }
    }
    .consola-box {
        grid-area: consola;
        display: flex;
        flex-direction: column-reverse;
        padding: 10px;
        padding-bottom: 5px;
    }
    .consola {
        flex-direction: row;
        font-size: 12px;
    }
</style>
